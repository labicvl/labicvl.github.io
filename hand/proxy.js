/*pub-1|2012-03-14 15:10:29*/var crossFrame={init:{},setHeight:{}};(function(){var _TRANSFORMERS_JSON_js=(function(){if(!JSON){var JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());return JSON})();var _TRANSFORMERS_postMsg_js=(function(){function Message(target){var self=this,isStart=false,DELAY=50;this.callbackList=[];this.msgList=[];this.log=function(msg,cat,src){if(location&&(location.search||"").indexOf("cd-debug")!==-1){if(src){msg=src+": "+msg}if(window.console!==undefined&&console.log){console[cat&&console[cat]?cat:"log"](msg)}}};this._fireSend=function(){if(isStart){return }isStart=true;var msg,timer;timer=setInterval(function(){if(self.msgList.length==0){return }msg=self.msgList.shift();msg.target.name=msg.data},DELAY)};this.send=function(data){self.log("+ "+document.domain+" send :"+data);if(window.postMessage){target.postMessage(data,"*")}else{self.msgList.push({target:target,data:data})}};this.on=function(callback){if(typeof callback!=="function"){return }this.callbackList.push(callback)};this._trigger=function(data){self.log("+ "+document.domain+" recived :"+data);for(var i=this.callbackList.length;i>0;i--){this.callbackList[i-1].call(window,data)}self.log("+ "+document.domain+" recived : end")};this.detach=function(fn){if(typeof (fn)=="undefined"){self.callbackList=[];return }else{if(typeof (fn)=="function"){for(var i=0;i<self.callbackList.length;i++){if(fn==self.callbackList[i]){self.callbackList.splice(i,1)}}}}};if(window.postMessage){if(window.addEventListener){window.addEventListener("message",function(e){self._trigger(e.data)},false)}else{if(window.attachEvent){window.attachEvent("onmessage",function(e){self._trigger(e.data)})}}}else{var hash=window.name="used by postmsg";setInterval(function(){if(window.name!==hash){hash=window.name;var tmp=hash;hash=window.name="used by postmsg";self._trigger(tmp)}},DELAY)}self._fireSend()}return Message})();var _TRANSFORMERS_crossDomain_js=(function(){function crossDomain(targetWindow){var Message=_TRANSFORMERS_postMsg_js,postMsg=new Message(targetWindow),guid=0,DELAY=100,TIMEOUT=8000,SURE="@sure@",RESET="@reset@",self=this,JSON=_TRANSFORMERS_JSON_js;this._pack=function(bag){return JSON.stringify(bag)};this._unpack=function(bag){try{return JSON.parse(bag)}catch(e){return }};this.query=function(event,callback){event.retry=typeof (event.retry)=="undefined"?true:event.retry;if(event.retry){guid++}var bag={id:event.id||guid,eventName:event.eventName,eventStr:event.eventStr,isCallback:typeof (callback)==="function",retry:event.retry};bag=self._pack(bag);if(event.retry&&event.eventName!=SURE){var timer;postMsg.log(document.domain+" \u5b9a\u65f6\u5668\u542f\u52a8  "+bag);timer=setInterval(function(){postMsg.log(document.domain+"-----------------------");postMsg.send(bag)},DELAY);setTimeout(function(){clearInterval(timer)},TIMEOUT);var fn=function(data){clearInterval(timer);postMsg.log(document.domain+" \u5b9a\u65f6\u5668\u5173\u95ed  "+bag)};self._on(SURE,fn,guid)}postMsg.send(bag);typeof (callback)==="function"&&self._on(event.eventName,callback,guid);return guid};this.fire=function(eventName,msg){return this.query({eventName:eventName,eventStr:msg})};this.on=function(eventName,callback){this._on(eventName,callback)};this._on=function(eventName,callback,id){var fn=function(data){data=self._unpack(data);if(!data){return }if(data.eventName!=eventName){postMsg.log(document.domain+" \u540d\u5b57"+eventName+"\u6bd4\u5bf9\u5931\u8d25  "+self._pack(data));return }if(data.id<guid&&data.eventName!=RESET){postMsg.log(document.domain+" \u91cd\u590d\u7684\u5305  "+self._pack(data));return }if(typeof (id)!="undefined"&&id!=data.id-1){postMsg.log(document.domain+" \u5e8f\u5217\u53f7"+id+"\u6bd4\u5bf9\u5931\u8d25  "+self._pack(data));return }if(data.eventName!=SURE){if(data.retry){self.query({id:data.id+1,eventName:SURE,retry:false})}guid++}if(typeof (id)!="undefined"){postMsg.detach(fn)}callback(data)};postMsg.on(fn)};this._on(RESET,function(data){postMsg.log(document.domain+" guid \u91cd\u7f6e");guid=0});this.query({eventName:RESET,retry:false})}return crossDomain})();if(window.top==window){return }var lastHeight,CrossDomain=_TRANSFORMERS_crossDomain_js,cross=new CrossDomain(window.parent);crossFrame.setHeight=function(height){if(height===undefined||height<700){height=docHeight()}if(lastHeight==height){return }lastHeight=height;cross.query({eventName:"setHeight",eventStr:height})};function docHeight(){try{return document.body.offsetHeight+2}catch(e){return }}function init(){cross.on("getHeight",function(data){var height=docHeight();if(height){cross.query({eventName:"setHeight",eventStr:height})}});cross.on("test",function(data){cross.query({eventName:"test",eventStr:data.eventStr})});setInterval(function(){crossFrame.setHeight()},500)}return init()})();crossFrame.init=crossFrame.setHeight;